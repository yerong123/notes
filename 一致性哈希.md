# 一致性哈希

## 什么是哈希
### 哈希翻译为`散列`。直译为`哈希`。
###一般说哈希，说的都是哈希算法，也叫散列算法。但它不是一种固定的算法，哈希算法是一种概念，实际哈希算法有多种，常见的有`md5`和`sha1`。

## 什么是哈希算法

### 哈希算法将任意长度的二进制值映射为较短的固定长度的二进制值，这个小的二进制值称为哈希值。

### 哈希算法特点：
* 可重复：不同的输入经过哈希算法有可能得到相同的输出。
* 不可逆：基于`可重复`的特点，所以不可逆（从hash值反推出输入是不可能的）

### 哈希像个map，不管是什么值，都能找到map中对应的映射关系，然后映射出一个固定长度的值


## 一致性哈希（consistent hashing）

一致性哈希算法在1997年由麻省理工学院提出的一种分布式哈希（DHT）实现算法。

### 场景
比如你有N个cache服务器，那么如何将一个对象object映射到N个cache上呢。可能会采用类似下面的通用方法计算object的hash值，然后均匀的映射到到N个cache（对N取模）：

hash(object)%N

一切都运行正常，但考虑如下的两种情况；

1. 一个cache服务器m down掉了（在实际应用中必须要考虑这种情况），这样所有映射到cache m的对象都会失效，怎么办，需要把cache m 从cache中移除，这时候cache是N-1台，映射公式变成了hash(object)%(N-1)；

2. 由于访问加重，需要添加cache，这时候cache是N+1台，映射公式变成了hash(object)%(N+1)；

1的情况下，即便改变算法公式，也会有一个瞬间（改变公式的过程中），有object找不到cache。2的情况下，即便改变算法公式，也会有一个瞬间（改变公式的过程中），有cache获取不到object。

###一致性哈希算法，判断算法好坏的定义：

#### 单调性

 Hash算法的一个衡量指标是单调性（ Monotonicity ），定义如下：

　　单调性是指如果已经有一些内容通过哈希分派到了相应的缓冲中，又有新的缓冲加入到系统中。哈希的结果应能够保证原有已分配的内容可以被映射到新的缓冲中去，而不会被映射到旧的缓冲集合中的其他缓冲区。
（这里面说的缓冲，可以简单的理解为实际场景中的服务器）

#### 平衡性

考量 Hash 算法的另一个指标是平衡性 (Balance) ，定义如下：

　　平衡性是指哈希的结果能够尽可能分布到所有的缓冲中去，这样可以使得所有的缓冲空间都得到利用。


需要引入`虚拟节点`

参考：http://blog.csdn.net/sparkliang/article/details/5279393


#### 一致性哈希

考虑通常的 hash 算法都是将 value 映射到一个 32 为的 key 值，也即是 0~2^32-1 次方的数值空间；我们可以将这个空间想象成一个首（ 0 ）尾（ 2^32-1 ）相接的圆环。  cache和object经过hash后，分布到圆上，object顺时针寻找cache。


